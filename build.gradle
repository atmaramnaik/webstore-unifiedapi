buildscript {
    repositories {
        mavenCentral()
    }
    dependencies{
        classpath('se.transmode.gradle:gradle-docker:1.2')
    }
}
group = "atmaram"
apply plugin: 'idea'
apply plugin: 'docker'
repositories {
    mavenCentral()
}
task copyOthers(){
    copy {
        from '.'
        into 'build/docker'
        exclude 'build'
    }
}
task copyToBuild(type: Exec,dependsOn: copyOthers) {
    commandLine 'sh', '-c', 'cp conf/$ENV.cfg build/docker/haproxy.cfg'
}

task buildDocker(type: Docker,dependsOn: copyToBuild) {
    push = false
    applicationName="webstore-unifiedapi"
    tagVersion="v0.0.1"
    tag="${project.group}/${applicationName}"
    dockerfile = file('Dockerfile')
}
task buildAndPushDocker(type: Docker,dependsOn: copyToBuild) {
    push = true
    applicationName="webstore-unifiedapi"
    tagVersion="v0.0.1"
    tag="${project.group}/${applicationName}"
    dockerfile = file('Dockerfile')
}